# contract 기능 명세서:

- 컨트랙트는 생성 시에 거래에 사용할 StableKRW, ERC20 컨트랙트 입력 받고 추후에 모든 거래 시에 해당 토큰으로만 거래가 가능하다로고 한다.

- 컨트랙트 내 거래는 (생성 → 거래대금 입금 → 송장번호 입력 → 배송완료 → 정산 완료) 와 같은 상태를 enum으로 갖고 있으며 플로우에 따라서 상태값이 변경된다.
<!-- 3. 판매자 김라인은 DTE(Decentralized Trade Escrow) 서비스를 통해서, 새로운 거래를 생성한 뒤. 구매자 김카카오씨 챗으로 전달한다.  -->

# contract function 기능 명세서:

1. 구매자는 결제를 희망하면, 거래를 생성한 뒤 deposit 하여 해당 거래 정보를 판매자에게 전달한다.

- 거래 생성은 컨트랙트를 통해서 이뤄진다. 생성시 구매자의 수령 주소지(해시값을)를 거래에 등록한다. (거래 상태: 생성)
- 생성 시에 구매금(StableKRW, ERC20)을 컨트랙트에 deposit한다 (ERC20 컨트랙트가 한번에 다 처리되는지 모르겠지만 거래상태를 거래대금 입금으로 변경한다)

<!-- 6.  판매자는 택배를 송부 후에, 송장번호를 이미지 전달(필요할까?) 후에 오라클(Kaia Orakl) 서비스를 통해서 송부한 사실을 컨트랙트에 전달한다. 데이터가 전달되면 컨트랙트는 해당 거래를 다음 단계로 진행시킨다.
      (오라클 서비스는: Orakl을 사용하며, 택배 정보는 https://info.sweettracker.co.kr/apidoc/ API를 통해서 데이터를 받아옴) - 받아온 샘플 데이터 -->

<!-- 판매자는 플랫폼에서 DTE를 통해 대금이 결제 된 것을 확인하고 48시간 이내에 택배를 보낸 후 택배 송장번호를 카카오페이와 연동된 DTE에 입력한다.  -->

2. 판매자는 컨트랙트를 통해 대금이 deposit된 것을 확인한다. (거래 id 기반으로 view function)

- 구매자로부터 전달받은 거래 id를 통해서, 거래 정보를 조회하여 송부하기 전에 체크한다.

3. 판매자는 확인 후 48시간 이내에 택배를 보낸 후 택배 송장번호를 컨트랙트에 입력한다.

- 입력된 송장번호는 내부 오라클 서비스를 통해서, 해당 거래의 결제 상태를 변경시킨다.
- 오라클 서비스는 contract 내부의 private API_KEY를 통해서 택배 API를 호출하고 최종적으로 호출된 송장정보를 기반으로 거래정보를 업데이트한다. (거래 상태: 배송 중)

4. 배송기간은 기본적으로 7일이 부여된다. 구매자는 7일 이내에 정상적으로 물품을 수령했다면 구매자는 7일 이내에 정상적으로 문제가 없는 물품을 수령했다면 아무 조치를 취할 필요가 없다.

- 거래 최종상태 변경를 배송완료로 변경한다.
- 컨트랙트는 판매자의 지갑으로 구매자가 deposit했던 양만큼 StableKRW(ERC20) 토큰을 가져갈 수 있게 한다.
